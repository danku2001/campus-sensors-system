{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DAN\\\\Desktop\\\\fullProject\\\\frontend-react\\\\frontend-react\\\\src\\\\components\\\\ShadingCard.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport { getSensorValues } from '../api/sensors';\n\n// כלל לדוגמה: אם קיימת מדידת temp >= 40 וגם light >= 70 באזור -> \"פתח הצללה\", אחרת \"סגור\"\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ShadingCard({\n  sensors\n}) {\n  _s();\n  const [status, setStatus] = useState('בודק...');\n  const [basis, setBasis] = useState({\n    temp: '-',\n    light: '-'\n  });\n  useEffect(() => {\n    let mounted = true;\n    async function load() {\n      if (!sensors || sensors.length === 0) {\n        setStatus('אין סנסורים');\n        return;\n      }\n      // לוקחים כמה סנסורים ראשונים כדי לא להפציץ בבקשות\n      const top = sensors.slice(0, 8);\n      const reads = await Promise.all(top.map(s => getSensorValues(s.id, 10).catch(() => [])));\n      let maxTemp = -Infinity,\n        maxLight = -Infinity;\n      reads.forEach(arr => {\n        arr.forEach(v => {\n          const metric = String(v.metric || '').toLowerCase();\n          if (metric.includes('temp') || metric.includes('טמפ')) maxTemp = Math.max(maxTemp, Number(v.value));\n          if (metric.includes('light') || metric.includes('אור')) maxLight = Math.max(maxLight, Number(v.value));\n        });\n      });\n      const t = isFinite(maxTemp) ? maxTemp : '-';\n      const l = isFinite(maxLight) ? maxLight : '-';\n      if (!mounted) return;\n      setBasis({\n        temp: t,\n        light: l\n      });\n      if (isFinite(maxTemp) && isFinite(maxLight) && maxTemp >= 40 && maxLight >= 70) setStatus('מומלץ לפתוח');else setStatus('מומלץ לסגור');\n    }\n    load();\n    return () => {\n      mounted = false;\n    };\n  }, [sensors]);\n  const ok = status.includes('לפתוח');\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"section card\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"hbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\u05DE\\u05E2\\u05E8\\u05DB\\u05EA \\u05D4\\u05E6\\u05DC\\u05DC\\u05D4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"badge\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: `dot ${ok ? 'warn' : 'ok'}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 40,\n          columnNumber: 33\n        }, this), status]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n      className: \"sub\",\n      children: \"\\u05D7\\u05D9\\u05E9\\u05D5\\u05D1 \\u05D0\\u05D5\\u05D8\\u05D5\\u05DE\\u05D8\\u05D9 \\u05DC\\u05E4\\u05D9 \\u05DE\\u05D3\\u05D9\\u05D3\\u05D5\\u05EA \\u05D0\\u05D6\\u05D5\\u05E8 (\\u05DC\\u05DC\\u05D0 \\u05E9\\u05DE\\u05D9\\u05E8\\u05D4 \\u05D1\\u05BEDB)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"kv\",\n      style: {\n        marginTop: 8\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\\u05D8\\u05DE\\u05E4\\u05F3 \\u05DE\\u05E7\\u05E1\\u05D9\\u05DE\\u05DC\\u05D9\\u05EA\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: basis.temp\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 33\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\\u05D0\\u05D5\\u05E8 \\u05DE\\u05E7\\u05E1\\u05D9\\u05DE\\u05DC\\u05D9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: basis.light\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 31\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 37,\n    columnNumber: 5\n  }, this);\n}\n_s(ShadingCard, \"SHPCf8u79Uw7L4rPjdXNEKPxU14=\");\n_c = ShadingCard;\nvar _c;\n$RefreshReg$(_c, \"ShadingCard\");","map":{"version":3,"names":["useEffect","useState","getSensorValues","jsxDEV","_jsxDEV","ShadingCard","sensors","_s","status","setStatus","basis","setBasis","temp","light","mounted","load","length","top","slice","reads","Promise","all","map","s","id","catch","maxTemp","Infinity","maxLight","forEach","arr","v","metric","String","toLowerCase","includes","Math","max","Number","value","t","isFinite","l","ok","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginTop","_c","$RefreshReg$"],"sources":["C:/Users/DAN/Desktop/fullProject/frontend-react/frontend-react/src/components/ShadingCard.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { getSensorValues } from '../api/sensors';\r\n\r\n// כלל לדוגמה: אם קיימת מדידת temp >= 40 וגם light >= 70 באזור -> \"פתח הצללה\", אחרת \"סגור\"\r\nexport default function ShadingCard({ sensors }) {\r\n  const [status, setStatus] = useState('בודק...');\r\n  const [basis, setBasis] = useState({ temp: '-', light: '-' });\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      if (!sensors || sensors.length === 0) { setStatus('אין סנסורים'); return; }\r\n      // לוקחים כמה סנסורים ראשונים כדי לא להפציץ בבקשות\r\n      const top = sensors.slice(0, 8);\r\n      const reads = await Promise.all(top.map(s => getSensorValues(s.id, 10).catch(()=>[])));\r\n      let maxTemp = -Infinity, maxLight = -Infinity;\r\n      reads.forEach(arr => {\r\n        arr.forEach(v => {\r\n          const metric = String(v.metric || '').toLowerCase();\r\n          if (metric.includes('temp') || metric.includes('טמפ')) maxTemp = Math.max(maxTemp, Number(v.value));\r\n          if (metric.includes('light') || metric.includes('אור')) maxLight = Math.max(maxLight, Number(v.value));\r\n        });\r\n      });\r\n      const t = isFinite(maxTemp) ? maxTemp : '-';\r\n      const l = isFinite(maxLight) ? maxLight : '-';\r\n      if (!mounted) return;\r\n      setBasis({ temp: t, light: l });\r\n      if (isFinite(maxTemp) && isFinite(maxLight) && maxTemp >= 40 && maxLight >= 70) setStatus('מומלץ לפתוח');\r\n      else setStatus('מומלץ לסגור');\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [sensors]);\r\n\r\n  const ok = status.includes('לפתוח');\r\n  return (\r\n    <div className=\"section card\">\r\n      <div className=\"hbar\">\r\n        <h3>מערכת הצללה</h3>\r\n        <span className=\"badge\"><span className={`dot ${ok ? 'warn':'ok'}`} />{status}</span>\r\n      </div>\r\n      <small className=\"sub\">חישוב אוטומטי לפי מדידות אזור (ללא שמירה ב־DB)</small>\r\n      <div className=\"kv\" style={{marginTop:8}}>\r\n        <div>טמפ׳ מקסימלית</div><div>{basis.temp}</div>\r\n        <div>אור מקסימלי</div><div>{basis.light}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}